From 0d5bfe93fe926af67404aa56ddbbe5802ace8d5c Mon Sep 17 00:00:00 2001
From: TheGreatMcPain <james@thegreatmcpain.xyz>
Date: Sun, 30 Oct 2022 01:56:11 -0500
Subject: [PATCH] Use same version of ndk

Override crate.io's version of ndk with the fork on github.com
listed in 'alvr/client_core/Cargo.toml'.

This allows 'cargo vendor' to run without error.
---
 Cargo.lock                  | 55 ++++++++++++-------------------------
 alvr/client_core/Cargo.toml |  8 ++++--
 2 files changed, 23 insertions(+), 40 deletions(-)

diff --git a/Cargo.lock b/Cargo.lock
index 419c51f0..a17e45e2 100644
--- a/Cargo.lock
+++ b/Cargo.lock
@@ -146,9 +146,9 @@ dependencies = [
  "futures",
  "glyph_brush_layout",
  "jni 0.20.0",
- "ndk 0.7.0 (git+https://github.com/zarik5/android-ndk-rs?rev=f1d38a0)",
+ "ndk 0.7.0",
  "ndk-context",
- "ndk-sys 0.4.0 (git+https://github.com/zarik5/android-ndk-rs?rev=f1d38a0)",
+ "ndk-sys 0.4.0",
  "oboe",
  "rand",
  "serde",
@@ -662,9 +662,9 @@ dependencies = [
 
 [[package]]
 name = "cc"
-version = "1.0.73"
+version = "1.0.74"
 source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "2fff2a6927b3bb87f9595d67196a70493f627687a71d87a0d692242c33f58c11"
+checksum = "581f5dba903aac52ea3feb5ec4810848460ee833876f1f9b0fdeab1f19091574"
 dependencies = [
  "jobserver",
 ]
@@ -765,9 +765,9 @@ dependencies = [
 
 [[package]]
 name = "cmake"
-version = "0.1.48"
+version = "0.1.49"
 source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "e8ad8cef104ac57b68b89df3208164d228503abbdce70f6880ffa3d970e7443a"
+checksum = "db34956e100b30725f2eb215f90d4871051239535632f84fea3bc92722c66b7c"
 dependencies = [
  "cc",
 ]
@@ -915,7 +915,7 @@ dependencies = [
  "js-sys",
  "libc",
  "mach",
- "ndk 0.7.0 (registry+https://github.com/rust-lang/crates.io-index)",
+ "ndk 0.7.0",
  "ndk-context",
  "nix 0.25.0",
  "oboe",
@@ -2197,9 +2197,9 @@ dependencies = [
 
 [[package]]
 name = "iana-time-zone"
-version = "0.1.51"
+version = "0.1.53"
 source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "f5a6ef98976b22b3b7f2f3a806f858cb862044cfa66805aa3ad84cb3d3b785ed"
+checksum = "64c122667b287044802d6ce17ee2ddf13207ed924c712de9a66a5814d5b64765"
 dependencies = [
  "android_system_properties",
  "core-foundation-sys",
@@ -2641,20 +2641,7 @@ checksum = "451422b7e4718271c8b5b3aadf5adedba43dc76312454b387e98fae0fc951aa0"
 dependencies = [
  "bitflags",
  "jni-sys",
- "ndk-sys 0.4.0 (registry+https://github.com/rust-lang/crates.io-index)",
- "num_enum",
- "raw-window-handle 0.5.0",
- "thiserror",
-]
-
-[[package]]
-name = "ndk"
-version = "0.7.0"
-source = "git+https://github.com/zarik5/android-ndk-rs?rev=f1d38a0#f1d38a07468c0aecdb325593f2467040e94657d7"
-dependencies = [
- "bitflags",
- "jni-sys",
- "ndk-sys 0.4.0 (git+https://github.com/zarik5/android-ndk-rs?rev=f1d38a0)",
+ "ndk-sys 0.4.0",
  "num_enum",
  "raw-window-handle 0.5.0",
  "thiserror",
@@ -2689,10 +2676,10 @@ checksum = "0434fabdd2c15e0aab768ca31d5b7b333717f03cf02037d5a0a3ff3c278ed67f"
 dependencies = [
  "libc",
  "log",
- "ndk 0.7.0 (registry+https://github.com/rust-lang/crates.io-index)",
+ "ndk 0.7.0",
  "ndk-context",
  "ndk-macro",
- "ndk-sys 0.4.0 (registry+https://github.com/rust-lang/crates.io-index)",
+ "ndk-sys 0.4.0",
  "once_cell",
  "parking_lot 0.12.1",
 ]
@@ -2728,14 +2715,6 @@ dependencies = [
  "jni-sys",
 ]
 
-[[package]]
-name = "ndk-sys"
-version = "0.4.0"
-source = "git+https://github.com/zarik5/android-ndk-rs?rev=f1d38a0#f1d38a07468c0aecdb325593f2467040e94657d7"
-dependencies = [
- "jni-sys",
-]
-
 [[package]]
 name = "nix"
 version = "0.22.3"
@@ -2977,9 +2956,9 @@ dependencies = [
 
 [[package]]
 name = "once_cell"
-version = "1.15.0"
+version = "1.16.0"
 source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "e82dad04139b71a90c080c8463fe0dc7902db5192d939bd0950f074d014339e1"
+checksum = "86f0b0d4bf799edbc74508c1e8bf170ff5f41238e5f8225603ca7caaae2b7860"
 
 [[package]]
 name = "openssl"
@@ -3028,9 +3007,9 @@ dependencies = [
 
 [[package]]
 name = "os_str_bytes"
-version = "6.3.0"
+version = "6.3.1"
 source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "9ff7415e9ae3fff1225851df9e0d9e4e5479f947619774677a63572e55e80eff"
+checksum = "3baf96e39c5359d2eb0dd6ccb42c62b91d9678aa68160d261b9e0ccbf9e9dea9"
 dependencies = [
  "memchr",
 ]
@@ -5030,7 +5009,7 @@ dependencies = [
  "libc",
  "log",
  "mio",
- "ndk 0.7.0 (registry+https://github.com/rust-lang/crates.io-index)",
+ "ndk 0.7.0",
  "ndk-glue 0.7.0",
  "objc",
  "once_cell",
diff --git a/alvr/client_core/Cargo.toml b/alvr/client_core/Cargo.toml
index aed55223..16223750 100644
--- a/alvr/client_core/Cargo.toml
+++ b/alvr/client_core/Cargo.toml
@@ -30,13 +30,17 @@ tokio = { version = "1", features = ["rt-multi-thread", "macros", "time"] }
 [target.'cfg(target_os = "android")'.dependencies]
 android_logger = "0.11"
 jni = "0.20"
+ndk = "0.7.0"
+ndk-context = "0.1"
+ndk-sys = "0.4.0"
+oboe = "0.4" # todo: remove once AudioThread shutdown crash is fixed
+
+[path.cartes-io]
 ndk = { git = "https://github.com/zarik5/android-ndk-rs", rev = "f1d38a0", features = [
     "api-level-26",
     "media",
 ] }
-ndk-context = "0.1"
 ndk-sys = { git = "https://github.com/zarik5/android-ndk-rs", rev = "f1d38a0" }
-oboe = "0.4" # todo: remove once AudioThread shutdown crash is fixed
 
 [build-dependencies]
 bindgen = "0.61"
-- 
2.37.4

